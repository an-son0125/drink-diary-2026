<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 ÁøäÁ∂≠È£≤ÊñôÊó•Ë®ò</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        :root { --main-theme: #f87171; --main-bg: #fdf6e3; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--main-bg); color: #444; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .day-cell { aspect-ratio: 1/1; border-radius: 12px; display: flex; flex-col; align-items: center; justify-content: center; position: relative; cursor: pointer; border: 1px solid #f3f4f6; background: white; transition: all 0.2s; }
        .day-cell:active { transform: scale(0.9); }
        .day-cell.other-month { opacity: 0.2; pointer-events: none; }
        .day-cell.today { border: 2px solid var(--main-theme); }
        .day-cell.has-data { background-color: #fee2e2; border-color: #fca5a5; }
        .day-cell.multi { background-color: #fca5a5; border-color: #ef4444; color: white; }
        
        .chip { padding: 6px 12px; border-radius: 99px; border: 1px solid #e5e7eb; font-size: 13px; background: white; cursor: pointer; }
        .chip.selected { background: var(--main-theme); color: white; border-color: var(--main-theme); }
        
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 99px; z-index: 100; font-size: 14px; display: none; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <div id="toast" class="toast">Â∑≤ÂÑ≤Â≠ò</div>

    <!-- Header -->
    <div class="p-4 bg-white shadow-sm flex justify-between items-center">
        <div>
            <h1 class="text-xl font-bold text-gray-800">2026 È£≤ÊñôÊó•Ë®ò</h1>
            <p class="text-[10px] text-red-500 font-bold uppercase">Local Storage Mode</p>
        </div>
        <div class="flex gap-2">
            <button onclick="exportData()" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><i class="fas fa-download"></i></button>
            <button onclick="openForm(getTodayStr())" class="w-10 h-10 rounded-full bg-red-400 text-white flex items-center justify-center shadow-lg"><i class="fas fa-plus"></i></button>
        </div>
    </div>

    <!-- Stats -->
    <div class="p-4 grid grid-cols-2 gap-3">
        <div class="bg-white p-3 rounded-2xl shadow-sm border border-gray-100">
            <p class="text-[10px] text-gray-400 font-bold mb-1">Êú¨ÊúàÊùØÊï∏</p>
            <p class="text-2xl font-bold text-red-500" id="stat-month-count">0</p>
        </div>
        <div class="bg-white p-3 rounded-2xl shadow-sm border border-gray-100">
            <p class="text-[10px] text-gray-400 font-bold mb-1">Âπ¥Â∫¶Á¥ØÁ©ç</p>
            <p class="text-2xl font-bold text-gray-700" id="stat-year-count">0</p>
        </div>
    </div>

    <!-- Calendar Controls -->
    <div class="px-4 flex justify-between items-center mb-2">
        <button onclick="prevMonth()" class="p-2 text-gray-400"><i class="fas fa-chevron-left"></i></button>
        <span id="current-month-label" class="font-bold text-gray-700 text-lg">2026Âπ¥ 1Êúà</span>
        <button onclick="nextMonth()" class="p-2 text-gray-400"><i class="fas fa-chevron-right"></i></button>
    </div>

    <!-- Calendar -->
    <div class="flex-grow overflow-y-auto px-4 pb-20">
        <div class="grid grid-cols-7 gap-1 text-center text-[10px] text-gray-400 font-bold mb-2">
            <div>Êó•</div><div>‰∏Ä</div><div>‰∫å</div><div>‰∏â</div><div>Âõõ</div><div>‰∫î</div><div>ÂÖ≠</div>
        </div>
        <div id="calendar-grid" class="calendar-grid"></div>
    </div>

    <!-- Modal: Entry Form -->
    <div id="modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-end sm:items-center justify-center p-0 sm:p-4">
        <div class="bg-white w-full max-w-md rounded-t-3xl sm:rounded-3xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 id="modal-title" class="font-bold text-lg">Êñ∞Â¢ûÁ¥ÄÈåÑ</h3>
                <button onclick="closeModal()" class="text-gray-400"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6 overflow-y-auto space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-gray-400">Â∫óÂêç</label>
                        <input type="text" id="in-shop" class="w-full border-b-2 py-2 outline-none focus:border-red-400" placeholder="Â∫óÂêç">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-400">ÂìÅÈ†Ö</label>
                        <input type="text" id="in-item" class="w-full border-b-2 py-2 outline-none focus:border-red-400" placeholder="ÂìÅÈ†Ö">
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-400">ÂÉπÊ†º</label>
                    <input type="number" id="in-price" class="w-full border-b-2 py-2 outline-none focus:border-red-400" placeholder="$">
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-400 block mb-2">ÁîúÂ∫¶</label>
                    <div class="flex flex-wrap gap-2" id="sugar-chips"></div>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-400 block mb-2">ÂÜ∞Â°ä</label>
                    <div class="flex flex-wrap gap-2" id="ice-chips"></div>
                </div>
            </div>
            <div class="p-4 border-t flex gap-2">
                <button id="del-btn" onclick="deleteEntry()" class="hidden flex-1 bg-gray-100 text-red-500 font-bold py-3 rounded-xl">Âà™Èô§</button>
                <button onclick="saveEntry()" class="flex-[2] bg-red-400 text-white font-bold py-3 rounded-xl shadow-lg">ÂÑ≤Â≠ò</button>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'drink_diary_2026_data';
        let db = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        let currentYear = 2026;
        let currentMonth = new Date().getMonth(); // 0-11
        let currentEditingDate = '';
        let currentEditingIndex = -1;
        
        const sugars = ['ÁÑ°Á≥ñ', 'ÂæÆÁ≥ñ', 'ÂçäÁ≥ñ', 'Â∞ëÁ≥ñ', 'ÂÖ®Á≥ñ'];
        const ices = ['ÂéªÂÜ∞', 'ÂæÆÂÜ∞', 'Â∞ëÂÜ∞', 'Ê≠£Â∏∏', 'ÁÜ±'];
        let selSugar = '', selIce = '';

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2000);
        }

        function getTodayStr() {
            const d = new Date();
            return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        }

        function saveDB() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
            renderAll();
            showToast('Â∑≤ÂÑ≤Â≠ò');
        }

        function renderAll() {
            renderStats();
            renderCalendar();
        }

        function renderStats() {
            let mCount = 0, yCount = 0;
            const mPrefix = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
            
            Object.keys(db).forEach(date => {
                const dayCount = db[date].length;
                if(date.startsWith(mPrefix)) mCount += dayCount;
                if(date.startsWith(`${currentYear}-`)) yCount += dayCount;
            });

            document.getElementById('stat-month-count').innerText = mCount;
            document.getElementById('stat-year-count').innerText = yCount;
            document.getElementById('current-month-label').innerText = `${currentYear}Âπ¥ ${currentMonth + 1}Êúà`;
        }

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';
            
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const todayStr = getTodayStr();

            // Padding
            for(let i=0; i<firstDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'day-cell other-month';
                grid.appendChild(empty);
            }

            // Actual days
            for(let d=1; d<=daysInMonth; d++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const records = db[dateStr] || [];
                
                const cell = document.createElement('div');
                cell.className = `day-cell ${dateStr === todayStr ? 'today' : ''} ${records.length > 0 ? (records.length > 1 ? 'multi' : 'has-data') : ''}`;
                
                cell.innerHTML = `
                    <span class="text-sm font-bold">${d}</span>
                    ${records.length > 0 ? `<span class="text-[10px] mt-1">${records.length > 1 ? records.length + 'ÊùØ' : 'ü•§'}</span>` : ''}
                `;
                
                cell.onclick = () => openForm(dateStr);
                grid.appendChild(cell);
            }
        }

        function openForm(dateStr, index = -1) {
            currentEditingDate = dateStr;
            currentEditingIndex = index;
            
            const record = (index > -1) ? db[dateStr][index] : { shop: '', item: '', price: '', sugar: '', ice: '' };
            
            document.getElementById('modal-title').innerText = `${dateStr} È£≤ÊñôÁ¥ÄÈåÑ`;
            document.getElementById('in-shop').value = record.shop;
            document.getElementById('in-item').value = record.item;
            document.getElementById('in-price').value = record.price;
            
            renderChips('sugar-chips', sugars, record.sugar, (v) => selSugar = v);
            renderChips('ice-chips', ices, record.ice, (v) => selIce = v);
            
            selSugar = record.sugar;
            selIce = record.ice;

            // Â¶ÇÊûúË©≤Êó•Â∑≤ÊúâË≥áÊñô‰ΩÜÈùûÁ∑®ËºØÁãÄÊÖãÔºåÈ°ØÁ§∫Ë©≤Êó•ÂàóË°®ÊàñÁõ¥Êé•ÈÄ≤ÂÖ•Êñ∞Â¢û
            const records = db[dateStr] || [];
            if(records.length > 0 && index === -1) {
                // ÈÄôË£°Á∞°ÂåñÈÇèËºØÔºöÂ¶ÇÊûúÂ∑≤ÊúâË≥áÊñôÔºåÈªûÊìäÊúÉÂÖàÂïè‰Ω†Ë¶ÅÁúãÂì™‰∏ÄÁ≠ÜÈÇÑÊòØÊñ∞Â¢û
                // ÁÇ∫‰∫ÜÁî®Êà∂È´îÈ©óÔºåÊàëÂÄëÁõ¥Êé•È°ØÁ§∫„ÄåÊúÄÂæå‰∏ÄÁ≠Ü„Äç‰æõÁ∑®ËºØÔºåÊàñÊ∏ÖÁ©∫‰æõÊñ∞Â¢û
                // ÈÄôË£°ÊîπÁÇ∫ÔºöÂ¶ÇÊûúÊúâË≥áÊñôÔºåÊ®ôÈ°åÈ°ØÁ§∫„ÄåÊñ∞Â¢ûÁ¨¨ N ÊùØ„Äç
                document.getElementById('modal-title').innerText = `${dateStr} (Á¨¨ ${records.length + 1} ÊùØ)`;
            }

            document.getElementById('del-btn').classList.toggle('hidden', index === -1);
            document.getElementById('modal').classList.remove('hidden');
        }

        function renderChips(containerId, list, selected, onSelect) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            list.forEach(item => {
                const btn = document.createElement('button');
                btn.className = `chip ${item === selected ? 'selected' : ''}`;
                btn.innerText = item;
                btn.onclick = () => {
                    Array.from(container.children).forEach(c => c.classList.remove('selected'));
                    btn.classList.add('selected');
                    onSelect(item);
                };
                container.appendChild(btn);
            });
        }

        function saveEntry() {
            const shop = document.getElementById('in-shop').value;
            const item = document.getElementById('in-item').value;
            const price = document.getElementById('in-price').value;
            
            if(!shop || !item) { alert('Ë´ãÂ°´ÂØ´Â∫óÂêçËàáÂìÅÈ†Ö'); return; }
            
            const entry = { shop, item, price, sugar: selSugar, ice: selIce };
            
            if(!db[currentEditingDate]) db[currentEditingDate] = [];
            
            if(currentEditingIndex > -1) {
                db[currentEditingDate][currentEditingIndex] = entry;
            } else {
                db[currentEditingDate].push(entry);
            }
            
            saveDB();
            closeModal();
        }

        function deleteEntry() {
            if(confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÁ≠ÜÁ¥ÄÈåÑÂóéÔºü')) {
                db[currentEditingDate].splice(currentEditingIndex, 1);
                if(db[currentEditingDate].length === 0) delete db[currentEditingDate];
                saveDB();
                closeModal();
            }
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        function prevMonth() { currentMonth--; if(currentMonth < 0) { currentMonth = 11; currentYear--; } renderAll(); }
        function nextMonth() { currentMonth++; if(currentMonth > 11) { currentMonth = 0; currentYear++; } renderAll(); }

        function exportData() {
            const blob = new Blob([JSON.stringify(db, null, 2)], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `È£≤ÊñôÊó•Ë®òÂÇô‰ªΩ_${getTodayStr()}.json`;
            a.click();
        }

        window.onload = renderAll;
    </script>
</body>
</html>
